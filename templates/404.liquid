{%- assign req_path = request.path | remove_last: '/' -%}
{%- assign target_handle_short = 'the-cbt-flip-chart-an-evidence-based-psychoeducational-tool-for-anxiety' -%}
{%- assign target_handle_long = 'the-cbt-flip-chart-an-evidence-based-psychoeducational-tool-for-anxiety-depression-stress-insomnia-ptsd-and-more' -%}
{%- assign target_path = '/product-page/' | append: target_handle_short -%}

{%- if req_path == target_path -%}
  {%- comment -%} Try short handle first {%- endcomment -%}
  {%- assign product = all_products[target_handle_short] -%}
  
  {%- comment -%} If not found, try long handle {%- endcomment -%}
  {%- if product == empty -%}
     {%- assign product = all_products[target_handle_long] -%}
  {%- endif -%}

  {%- if product != empty -%}
    {%- render 'cbt-landing-page', product: product -%}
  {%- else -%}
    {%- comment -%}Fallback if product lookup fails completely{%- endcomment -%}
    <section class="error-page">
      <div class="error-card">
        <h1>Product Not Found</h1>
        <p>We detected the correct URL, but could not load the product data from Shopify. Please check if the product handle is correct.</p>
        <p>Debug Path: {{ req_path }}</p>
         <div class="error-actions">
           <a href="/" class="button button-primary">Return home</a>
         </div>
      </div>
    </section>
  {%- endif -%}
{%- else -%}
  <section class="error-page">
    <div class="error-card">
      <span class="error-eyebrow">Page not found</span>
      <h1>Looks like the story you're after is missing.</h1>
      <p>
        The link you followed may be broken or the page might have been archived. Explore our featured
        collections or head back to the homepage to continue discovering new resources.
      </p>
      <div class="error-actions">
        <a href="/" class="button button-primary">Return home</a>
        <a href="/collections/all" class="button button-secondary">Browse all collections</a>
      </div>
      <ul class="error-links">
        <li><a href="/collections/new">Latest arrivals</a></li>
        <li><a href="/collections/bestsellers">Community favorites</a></li>
        <li><a href="/pages/contact">Connect with our team</a></li>
      </ul>
    </div>
  </section>
{%- endif -%}
