{%- if product == blank -%}
  <section class="product-unavailable">
    <div class="product-unavailable__content">
      <h1>Product coming soon</h1>
      <p>We're preparing our next release. Please check back soon for full details.</p>
    </div>
  </section>
{%- else -%}
  {%- assign form_id = 'product-form-' | append: product.id -%}
  {%- assign quantity_id = 'quantity-' | append: product.id -%}

  <section class="product-page" aria-labelledby="product-title">
    <nav class="product-breadcrumbs" aria-label="Breadcrumb">
      <a href="/">Home</a>
      <span aria-hidden="true">&rsaquo;</span>
      <span>{{ product.title }}</span>
    </nav>

    <div class="product-content">
      <div class="product-gallery">
        {%- if product.media.size > 0 -%}
          <div class="product-media-list" role="list">
            {%- for media in product.media -%}
              <figure class="product-media-thumb" role="listitem">
                {{
                  media
                  | media_tag:
                    class: 'product-media-image',
                    loading: 'lazy',
                    image_size: '2048x2048'
                }}
                {%- if media.alt != blank -%}
                  <figcaption class="visually-hidden">{{ media.alt }}</figcaption>
                {%- endif -%}
              </figure>
            {%- endfor -%}
          </div>
        {%- endif -%}

        <div class="product-media-featured">
          {%- if product.featured_media -%}
            {{
              product.featured_media
              | media_tag:
                class: 'product-media-main',
                loading: 'eager',
                image_size: '2048x2048'
            }}
          {%- else -%}
            <div class="product-media-placeholder">No media available</div>
          {%- endif -%}
        </div>
      </div>

      <aside class="product-details">
        <header class="product-header">
          <h1 id="product-title">{{ product.title }}</h1>
          {%- if product.vendor != blank -%}
            <p class="product-vendor">By {{ product.vendor }}</p>
          {%- endif -%}
        </header>

        {%- assign popularity_badge = product.metafields.custom.popularity_badge -%}
        {%- assign intro_badge = product.metafields.custom.promo_badge -%}
        {%- assign promo_detail = product.metafields.custom.promo_detail -%}
        {%- assign promo_timer = product.metafields.custom.promo_timer -%}

        <div class="product-pricing" aria-label="Pricing information">
          {%- if popularity_badge != blank -%}
            <p class="product-pricing__popularity">{{ popularity_badge }}</p>
          {%- endif -%}

          <div class="product-pricing__primary">
            <span class="product-pricing__price">{{ product.price | money }}</span>
            {%- if product.compare_at_price > product.price -%}
              <span class="product-pricing__compare">{{ product.compare_at_price | money }}</span>
            {%- endif -%}
          </div>

          {%- if intro_badge != blank or product.compare_at_price > product.price or promo_detail != blank or promo_timer != blank -%}
            <div class="product-pricing__meta">
              {%- if intro_badge != blank -%}
                <span class="product-pricing__badge">{{ intro_badge }}</span>
              {%- endif -%}

              {%- if product.compare_at_price > product.price -%}
                {%- assign price_ratio = product.price | times: 10000 | divided_by: product.compare_at_price -%}
                {%- assign discount_percentage = 10000 | minus: price_ratio -%}
                {%- assign discount_percentage = discount_percentage | divided_by: 100 -%}
                <span class="product-pricing__discount">{{ discount_percentage }}% off</span>
              {%- endif -%}

              {%- if promo_detail != blank -%}
                <span class="product-pricing__detail">{{ promo_detail }}</span>
              {%- endif -%}

              {%- if promo_timer != blank -%}
                <span class="product-pricing__timer">{{ promo_timer }}</span>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>

        {%- if product.description != blank -%}
          <div class="product-description">{{ product.description }}</div>
        {%- endif -%}

        {%- form 'product', product, id: form_id, class: 'product-form' -%}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

          {%- if product.variants.size > 1 -%}
            <div class="product-options">
              {%- for option in product.options_with_values -%}
                <fieldset class="product-option">
                  <legend>{{ option.name }}</legend>
                  <div class="product-option-values">
                    {%- for value in option.values -%}
                      {%- assign option_id = option.name | handleize | append: '-' | append: value | handleize -%}
                      <label class="product-option-value" for="{{ option_id }}">
                        <input
                          id="{{ option_id }}"
                          type="radio"
                          name="options[{{ option.name }}]"
                          value="{{ value }}"
                          {%- if option.selected_value == value -%}checked{%- endif -%}
                        >
                        <span>{{ value }}</span>
                      </label>
                    {%- endfor -%}
                  </div>
                </fieldset>
              {%- endfor -%}
            </div>
          {%- endif -%}

          <div class="product-cta">
            <label class="product-quantity" for="{{ quantity_id }}">Quantity</label>
            <input id="{{ quantity_id }}" name="quantity" type="number" min="1" value="1" inputmode="numeric">
            <button type="submit" class="button button-primary" {%- unless product.available -%}disabled{%- endunless -%}>
              {%- if product.available -%}
                Add to cart
              {%- else -%}
                Sold out
              {%- endif -%}
            </button>
          </div>
        {%- endform -%}

        <div class="product-extra">
          <h2>What makes this book special</h2>
          <ul>
            <li>Curated therapeutic practices to integrate each chapter.</li>
            <li>Thoughtfully designed print with premium, eco-conscious materials.</li>
            <li>Complimentary access to guided meditations and discussion circles.</li>
          </ul>
        </div>
      </aside>
    </div>
  </section>
{%- endif -%}
