{%- assign hero_excerpt = product.description | strip_html | truncatewords: 40 -%}

<section class="landing-hero product-hero">
  <div class="hero-content">
    {%- if product.vendor != blank -%}
      <span class="hero-badge">{{ product.vendor }}</span>
    {%- endif -%}
    <h1>{{ product.title }}</h1>
    {%- if hero_excerpt != blank -%}
      <p>{{ hero_excerpt }}</p>
    {%- else -%}
      <p>An immersive psychology edition designed to guide you through reflective practices, lyrical stories, and
        community rituals.</p>
    {%- endif -%}
    <div class="hero-actions">
      <a class="button button-primary" href="#product-purchase">Reserve your copy</a>
      <a class="button button-secondary" href="#inside-the-book">See what's inside</a>
    </div>
    <ul class="hero-highlights">
      <li>
        {%- if product.compare_at_price > product.price -%}
          Introductory price {{ product.price | money }} (Reg. {{ product.compare_at_price | money }})
        {%- else -%}
          Collector's edition {{ product.price | money }}
        {%- endif -%}
      </li>
      <li>Worldwide shipping plus digital ritual companion access</li>
      <li>Crafted with premium materials for lasting inspiration</li>
    </ul>
  </div>
  <div class="hero-visual">
    {%- if product.featured_media -%}
      <figure class="product-hero-visual">
        <img
          class="product-hero-image"
          src="{{ product.featured_media | image_url: width: 1200 }}"
          srcset="{{ product.featured_media | image_url: width: 600 }} 600w, {{ product.featured_media | image_url: width: 900 }} 900w, {{ product.featured_media | image_url: width: 1200 }} 1200w, {{ product.featured_media | image_url: width: 1800 }} 1800w, {{ product.featured_media | image_url: width: 2048 }} 2048w"
          sizes="(min-width: 1024px) 40vw, 90vw"
          alt="{{ product.featured_media.alt | default: product.title }}"
          loading="eager"
        >
        {%- if product.featured_media.alt != blank -%}
          <figcaption class="visually-hidden">{{ product.featured_media.alt }}</figcaption>
        {%- endif -%}
      </figure>
    {%- else -%}
      <div class="product-hero-placeholder">Imagery coming soon</div>
    {%- endif -%}
  </div>
</section>

{%- assign gallery_images = product.media | where: 'media_type', 'image' -%}
{%- if gallery_images.size > 0 -%}
  <section class="landing-section product-gallery">
    <header class="section-header">
      <h2>Product gallery</h2>
      <p>Explore every detail captured from across the collection.</p>
    </header>
    <div class="product-gallery-grid">
      {%- for media in gallery_images -%}
        <figure class="product-gallery-item">
          <img
            src="{{ media | image_url: width: 1200 }}"
            srcset="{{ media | image_url: width: 600 }} 600w, {{ media | image_url: width: 900 }} 900w, {{ media | image_url: width: 1200 }} 1200w, {{ media | image_url: width: 1600 }} 1600w"
            sizes="(min-width: 1024px) 30vw, 90vw"
            alt="{{ media.alt | default: product.title }}"
            loading="lazy"
          >
          {%- if media.alt != blank -%}
            <figcaption class="visually-hidden">{{ media.alt }}</figcaption>
          {%- endif -%}
        </figure>
      {%- endfor -%}
    </div>
  </section>
{%- endif -%}

<section id="inside-the-book" class="landing-section product-story">
  <header class="section-header">
    <h2>Inside "{{ product.title }}"</h2>
    <p>Immerse yourself in richly layered storytelling, reflective prompts, and guided practices that invite daily
      integration.</p>
  </header>
  <div class="product-story-content">
    {%- if product.description != blank -%}
      {{ product.description }}
    {%- else -%}
      <p>We are curating the full narrative description. Check back soon for a chapter-by-chapter overview.</p>
    {%- endif -%}
  </div>
</section>

<section class="landing-section product-features">
  <header class="section-header">
    <h2>Crafted for meaningful transformation</h2>
    <p>Every detail of {{ product.title }} invites you to slow down, breathe deeply, and translate insight into rituals.
    </p>
  </header>
  <div class="features-grid">
    <article class="feature-card">
      <h3>Integration rituals</h3>
      <p>Curated therapeutic practices to integrate each chapter.</p>
    </article>
    <article class="feature-card">
      <h3>Artful keepsake</h3>
      <p>Thoughtfully designed print with premium, eco-conscious materials.</p>
    </article>
    <article class="feature-card">
      <h3>Community access</h3>
      <p>Complimentary guided meditations and discussion circles to continue the journey.</p>
    </article>
  </div>
</section>

<section class="landing-section alt product-experience">
  <div class="section-content">
    <header class="section-header">
      <h2>Bring the experience into your space</h2>
      <p>Set the stage for evenings of reflection, creative restoration, and meaningful dialogue with those you love.</p>
    </header>
    <ul class="hero-highlights product-experience-list">
      <li>Downloadable soundscapes and journaling prompts for each reading session</li>
      <li>Access to live annotation salons with the author and fellow readers</li>
      <li>Beautiful packaging perfect for gifting or displaying in your studio</li>
    </ul>
  </div>
  <div class="section-visual">
    <div class="quote-card">
      <blockquote>"This edition feels like a gentle mentorâ€”part science, part poetry, entirely transformative."</blockquote>
      <cite>&mdash; Selah, Narrative Therapist</cite>
    </div>
  </div>
</section>

<section id="product-purchase" class="landing-section product-purchase">
  <header class="section-header">
    <h2>Reserve your copy of {{ product.title }}</h2>
    <p>Secure a beautifully crafted edition and receive immediate access to the digital ritual library.</p>
  </header>
    <div class="purchase-panel">
      <div class="purchase-pricing sale-info">
        <p class="sale-carts">In 20+ carts</p>
        <div class="sale-price-row">
          <span class="sale-current">Now $19.99</span>
          <span class="sale-old">$100.52</span>
          <span class="sale-badge">New markdown!</span>
        </div>
        <div
          class="sale-discount"
          role="text"
          data-countdown-container
          data-countdown-final="Sale ended"
        >
          <span>70% off</span>
          <span class="sale-divider" aria-hidden="true">&bull;</span>
          <span class="sale-countdown-text">
            Sale ends in
            <span
              class="sale-countdown"
              role="timer"
              aria-live="polite"
              data-countdown-hours="20"
            >20:00:00</span>
          </span>
        </div>
      </div>

      {%- assign form_id = 'product-form-' | append: product.id -%}
      {%- form 'product', product, id: form_id, class: 'product-purchase-form' -%}
        {%- if product.variants.size > 1 -%}
          <label class="purchase-label" for="variant-select-{{ product.id }}">Choose your edition</label>
          <select id="variant-select-{{ product.id }}" name="id">
            {%- for variant in product.variants -%}
              <option value="{{ variant.id }}" {%- if variant == product.selected_or_first_available_variant -%}selected{%- endif -%} {%- unless variant.available -%}disabled{%- endunless -%}>
                {{ variant.title }} &mdash; {{ variant.price | money }}{%- unless variant.available -%} (Sold out){%- endunless -%}
              </option>
            {%- endfor -%}
          </select>
        {%- else -%}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        {%- endif -%}

        <div class="purchase-actions">
          <button type="submit" class="button button-buy-now" formmethod="post" formaction="{{ routes.cart_add_url }}?return_to=/checkout"{% unless product.available %} disabled{% endunless %}>Buy now</button>
        </div>

      {%- endform -%}
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var timer = document.getElementById('purchase-countdown');
      if (!timer) return;

      var container = timer.closest('.purchase-countdown-text');
      var targetTime = Date.now() + (20 * 60 * 60 * 1000);

      function updateTimer() {
        var now = Date.now();
        var diff = targetTime - now;

        if (diff <= 0) {
          if (container) {
            container.textContent = 'Sale ended';
          } else {
            timer.textContent = 'Sale ended';
          }
          clearInterval(intervalId);
          return;
        }

        var hours = Math.floor(diff / (1000 * 60 * 60));
        var minutes = Math.floor((diff / (1000 * 60)) % 60);
        var seconds = Math.floor((diff / 1000) % 60);

        timer.textContent = [hours, minutes, seconds]
          .map(function (value) {
            return value.toString().padStart(2, '0');
          })
          .join(':');
      }

      updateTimer();
      var intervalId = setInterval(updateTimer, 1000);
    });
  </script>
