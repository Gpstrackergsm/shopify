{% assign featured_collection = nil %}

{%- comment -%}
  Gather the most relevant candidate collections in priority order:
  1. The collection selected in the theme settings
  2. The historical "frontpage" collection used by Shopify themes
  3. The automatic "all" collection as a last resort
{%- endcomment -%}
{% assign collection_candidates = '' %}
{% if settings.home_featured_collection != blank %}
  {% assign collection_candidates = settings.home_featured_collection %}
{% endif %}
{% assign collection_candidates = collection_candidates | append: ',frontpage,all' | split: ',' %}

{%- for handle in collection_candidates -%}
  {% assign trimmed_handle = handle | strip %}
  {% if trimmed_handle != blank and (featured_collection == nil or featured_collection.products_count == 0) %}
    {% assign candidate_collection = collections[trimmed_handle] %}
    {% if candidate_collection and candidate_collection.products_count > 0 %}
      {% assign featured_collection = candidate_collection %}
    {% endif %}
  {% endif %}
{%- endfor -%}

{%- comment -%}
  If no candidate handles return a populated collection (for example, if the
  original handle was renamed in the admin), fall back to the first published
  collection with products to keep the homepage populated automatically.
{%- endcomment -%}
{% if featured_collection == nil or featured_collection.products_count == 0 %}
  {% for collection in collections %}
    {% assign fallback_candidate = collection[1] | default: collection %}
    {% if fallback_candidate and fallback_candidate.handle != 'all' and fallback_candidate.products_count > 0 %}
      {% assign featured_collection = fallback_candidate %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if featured_collection == nil or featured_collection.products_count == 0 %}
  {% assign featured_collection = collections['all'] %}
{% endif %}

{% assign hero_products_exist = false %}
{% if featured_collection and featured_collection.products_count > 0 %}
  {% assign hero_products_exist = true %}
{% endif %}

<style>
  :root {
    --goodreads-green: #382110;
    --goodreads-gold: #f4f1ea;
    --goodreads-sage: #4a7c59;
    --goodreads-sand: #ede6d6;
    --goodreads-ink: #1f1a13;
    --goodreads-muted: #6b6048;
    --goodreads-border: #d6cfbf;
    --goodreads-card: #ffffff;
    font-family: "Georgia", "Merriweather", "Times New Roman", serif;
  }

  body {
    background-color: var(--goodreads-gold);
    color: var(--goodreads-ink);
    margin: 0;
  }

  .goodreads-page {
    min-height: 100vh;
    background-image: linear-gradient(180deg, rgba(237, 230, 214, 0.8), rgba(244, 241, 234, 0.95));
    padding-bottom: 4rem;
  }

  .goodreads-button {
    background: transparent;
    border: 1px solid var(--goodreads-border);
    border-radius: 999px;
    padding: 0.6rem 1.2rem;
    font-family: inherit;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--goodreads-green);
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
  }

  .goodreads-button.primary {
    background: var(--goodreads-green);
    color: #fff;
    border-color: var(--goodreads-green);
    box-shadow: 0 12px 24px rgba(56, 33, 16, 0.18);
  }

  .goodreads-button.primary:hover {
    background: #4e2e14;
  }

  .goodreads-button:hover {
    background: var(--goodreads-sand);
  }

  .goodreads-hero {
    max-width: 1240px;
    margin: 0 auto;
    padding: clamp(2rem, 4vw, 3.5rem) clamp(1.25rem, 4vw, 2rem);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
    gap: clamp(2rem, 5vw, 3rem);
    align-items: stretch;
  }

  .hero-text {
    display: flex;
    flex-direction: column;
    gap: 1.6rem;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--goodreads-sand);
    color: var(--goodreads-muted);
    padding: 0.45rem 0.95rem;
    border-radius: 999px;
    letter-spacing: 0.1em;
    font-size: 0.75rem;
    text-transform: uppercase;
    font-weight: 700;
  }

  .hero-title {
    font-size: clamp(2.75rem, 5vw, 3.6rem);
    font-weight: 700;
    line-height: 1.05;
    color: var(--goodreads-green);
  }

  .hero-subtitle {
    font-size: 1.1rem;
    color: var(--goodreads-muted);
    line-height: 1.7;
    max-width: 520px;
  }

  .hero-search {
    display: grid;
    grid-template-columns: 1fr auto;
    background: #fff;
    border: 1px solid var(--goodreads-border);
    border-radius: 50px;
    overflow: hidden;
    box-shadow: 0 18px 36px rgba(41, 25, 13, 0.12);
  }

  .hero-search input[type="search"] {
    border: none;
    padding: 0.9rem 1.4rem;
    font-size: 1rem;
    font-family: inherit;
    color: var(--goodreads-ink);
    outline: none;
  }

  .hero-search button {
    border: none;
    background: var(--goodreads-green);
    color: #fff;
    padding: 0 1.75rem;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
  }

  .hero-metrics {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }

  .hero-metric-card {
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid var(--goodreads-border);
    border-radius: 18px;
    padding: 1rem 1.4rem;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    text-align: left;
  }

  .hero-metric-card strong {
    font-size: 1.65rem;
    color: var(--goodreads-green);
  }

  .hero-picks {
    background: #fff;
    border-radius: 24px;
    border: 1px solid var(--goodreads-border);
    box-shadow: 0 24px 48px rgba(32, 21, 12, 0.15);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .hero-picks-header {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .hero-picks-header p {
    margin: 0;
    color: var(--goodreads-muted);
  }

  .hero-product-list {
    display: grid;
    gap: 1.25rem;
  }

  .hero-product-card {
    background: #fff;
    border-radius: 24px;
    border: 1px solid var(--goodreads-border);
    box-shadow: 0 24px 48px rgba(32, 21, 12, 0.15);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .hero-product-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .hero-product-info h3 {
    font-size: 1.4rem;
    margin: 0;
  }

  .hero-product-info .price {
    font-weight: 700;
    color: var(--goodreads-green);
  }

  .hero-product-cta {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .section {
    max-width: 1240px;
    margin: 0 auto;
    padding: clamp(2.5rem, 5vw, 3.75rem) clamp(1.25rem, 4vw, 2rem);
    display: grid;
    gap: 2rem;
  }

  .section header {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .section-title {
    font-size: clamp(1.8rem, 3.2vw, 2.3rem);
    color: var(--goodreads-green);
  }

  .section-subtitle {
    color: var(--goodreads-muted);
    max-width: 620px;
  }

  .featured-lists {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }

  .list-card {
    background: #fff;
    border: 1px solid var(--goodreads-border);
    border-radius: 18px;
    padding: 1.4rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    box-shadow: 0 12px 24px rgba(32, 21, 12, 0.08);
  }

  .list-card strong {
    font-size: 1.1rem;
    color: var(--goodreads-ink);
  }

  .list-card span {
    color: var(--goodreads-muted);
  }

  .product-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }

  .product-card {
    background: #fff;
    border-radius: 18px;
    border: 1px solid var(--goodreads-border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 16px 32px rgba(32, 21, 12, 0.1);
  }

  .product-card img {
    display: block;
    width: 100%;
    aspect-ratio: 3/4;
    object-fit: cover;
    background: var(--goodreads-sand);
  }

  .product-card-content {
    padding: 1.2rem 1.4rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .product-card-content h3 {
    font-size: 1.1rem;
    margin: 0;
    color: var(--goodreads-ink);
  }

  .product-card-content .price {
    font-weight: 700;
    color: var(--goodreads-green);
  }

  .product-card-content .rating {
    color: #c47f24;
    font-size: 0.9rem;
    letter-spacing: 0.06em;
  }

  .quotes-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .quote-card {
    background: #fff;
    border-radius: 16px;
    border: 1px solid var(--goodreads-border);
    padding: 1.6rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    box-shadow: 0 14px 28px rgba(32, 21, 12, 0.08);
    font-size: 1rem;
    line-height: 1.7;
  }

  .quote-card span {
    color: var(--goodreads-muted);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .community-section {
    background: #fff;
    border-radius: 24px;
    border: 1px solid var(--goodreads-border);
    padding: clamp(2rem, 4vw, 3rem);
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    box-shadow: 0 24px 36px rgba(32, 21, 12, 0.1);
  }

  .community-card {
    background: var(--goodreads-gold);
    border-radius: 18px;
    padding: 1.6rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    border: 1px solid var(--goodreads-border);
  }

  .newsletter {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 22px;
    border: 1px solid var(--goodreads-border);
    padding: clamp(2rem, 4vw, 3rem);
    display: grid;
    gap: 1rem;
    box-shadow: 0 18px 34px rgba(32, 21, 12, 0.08);
    text-align: center;
  }

  .newsletter form {
    display: grid;
    gap: 0.75rem;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }

  .newsletter input[type="email"] {
    border-radius: 999px;
    border: 1px solid var(--goodreads-border);
    padding: 0.85rem 1.25rem;
    font-family: inherit;
  }

  @media (max-width: 768px) {
    .hero-search {
      grid-template-columns: 1fr;
      border-radius: 18px;
    }

    .hero-search button {
      border-radius: 0 0 18px 18px;
      padding: 0.9rem 1.2rem;
    }
  }

  @media (max-width: 540px) {
    .hero-product-card {
      padding: 1.6rem;
    }
  }
</style>

<div class="goodreads-page">
  <main>
    <section class="goodreads-hero">
      <div class="hero-text">
        <span class="hero-badge">Readers' Haven</span>
        <h1 class="hero-title">Meet your next favorite book.</h1>
        <p class="hero-subtitle">Search and browse millions of titles, track what you want to read next, and see what your friends are reading. Welcome to your literary community.</p>
        <form class="hero-search" action="/search" method="get" role="search">
          <input type="search" name="q" placeholder="Search books, authors, or ISBN" aria-label="Search books">
          <button type="submit">Search</button>
        </form>
        <div class="hero-metrics" aria-label="Community highlights">
          <article class="hero-metric-card">
            <strong>90M+</strong>
            <span>Members sharing reviews and recommendations</span>
          </article>
          <article class="hero-metric-card">
            <strong>2.6B</strong>
            <span>Books shelved and tracked by readers</span>
          </article>
          <article class="hero-metric-card">
            <strong>50M</strong>
            <span>Reviews that help you decide what to read next</span>
          </article>
        </div>
      </div>

      <aside class="hero-picks" aria-label="Featured books">
        {% if hero_products_exist %}
          <div class="hero-picks-header">
            <span class="hero-badge">Reader's picks</span>
            <p>Our community highlights to jump-start your reading list.</p>
          </div>
          <div class="hero-product-list">
            {% for hero_product in featured_collection.products limit: 2 %}
              <article class="hero-product-card">
                <div class="hero-product-info">
                  {% if hero_product.featured_image %}
                    <img src="{{ hero_product.featured_image | img_url: '400x' }}" alt="{{ hero_product.title | escape }} cover" style="width: 160px; align-self: center; border-radius: 12px; box-shadow: 0 16px 32px rgba(32, 21, 12, 0.18);" />
                  {% endif %}
                  <h3>{{ hero_product.title }}</h3>
                  {% if hero_product.vendor %}
                    <span>{{ hero_product.vendor }}</span>
                  {% endif %}
                  <p class="price">{{ hero_product.price | money }}</p>
                  {% if hero_product.metafields.reviews.rating %}
                    <span class="rating">Rating: {{ hero_product.metafields.reviews.rating }} / 5</span>
                  {% endif %}
                </div>
                <div class="hero-product-cta">
                  <a class="goodreads-button primary" href="{{ hero_product.url }}">Add to shelf</a>
                  <a class="goodreads-button" href="{{ hero_product.url }}">Read more</a>
                </div>
              </article>
            {% endfor %}
          </div>
        {% else %}
          <div class="hero-product-list">
            <article class="hero-product-card">
              <div class="hero-product-info">
                <h3>Discover stories tailored to you</h3>
                <p class="price">Browse curated picks from our shelves.</p>
              </div>
              <div class="hero-product-cta">
                <a class="goodreads-button primary" href="/collections/all">Explore books</a>
              </div>
            </article>
          </div>
        {% endif %}
      </aside>
    </section>

    <section id="lists" class="section">
      <header>
        <h2 class="section-title">Trending on PsychoReads</h2>
        <p class="section-subtitle">Shelves and collections readers are loving this week. Dive into themed lists and discover what everyone is talking about.</p>
      </header>
      <div class="featured-lists">
        <article class="list-card">
          <strong>Summer Reading Challenge</strong>
          <span>Breezy beach reads, thrillers, and romances to fill your sunny afternoons.</span>
          <a class="goodreads-button" href="/collections/all">Browse list</a>
        </article>
        <article class="list-card">
          <strong>Book Club Favorites</strong>
          <span>Handpicked selections that spark discussion and stay with you long after the last page.</span>
          <a class="goodreads-button" href="/collections/all">See picks</a>
        </article>
        <article class="list-card">
          <strong>Debuts You'll Love</strong>
          <span>Fresh voices making waves in fiction, memoir, and speculative storytelling.</span>
          <a class="goodreads-button" href="/collections/all">Discover debuts</a>
        </article>
        <article class="list-card">
          <strong>Editors' Choice</strong>
          <span>Curated by our team from the latest releases and timeless classics.</span>
          <a class="goodreads-button" href="/collections/all">Explore shelves</a>
        </article>
      </div>
    </section>

    <section id="new-releases" class="section">
      <header>
        <h2 class="section-title">New releases from our bookstore</h2>
        <p class="section-subtitle">Keep your to-read list fresh with the latest arrivals loved by the PsychoReads community.</p>
      </header>
      <div class="product-grid">
        {% if featured_collection and featured_collection.products_count > 0 %}
          {% for product in featured_collection.products limit: 6 %}
            <article class="product-card">
              {% if product.featured_image %}
                <a href="{{ product.url }}">
                  <img src="{{ product.featured_image | img_url: '400x' }}" alt="{{ product.title | escape }} cover">
                </a>
              {% endif %}
              <div class="product-card-content">
                <h3><a href="{{ product.url }}" style="text-decoration: none; color: inherit;">{{ product.title }}</a></h3>
                {% if product.vendor %}
                  <span>{{ product.vendor }}</span>
                {% endif %}
                <span class="price">{{ product.price | money }}</span>
                <span class="rating">★★★★★</span>
              </div>
            </article>
          {% endfor %}
        {% else %}
          <p>No books are available yet. Check back soon!</p>
        {% endif %}
      </div>
    </section>

    <section class="section" aria-labelledby="community-highlights">
      <header>
        <h2 id="community-highlights" class="section-title">Because your friends are reading</h2>
        <p class="section-subtitle">See what other readers are adding to their shelves and keep track of your own reading journey.</p>
      </header>
      <div class="community-section">
        <article class="community-card">
          <strong>Track your reading</strong>
          <p>Create shelves, rate books, and jot down notes on every story you finish.</p>
          <a class="goodreads-button primary" href="/account/register">Start tracking</a>
        </article>
        <article class="community-card">
          <strong>Follow friends & authors</strong>
          <p>See updates from the people who inspire your reading and share your latest finds.</p>
          <a class="goodreads-button" href="/collections/all">Find recommendations</a>
        </article>
        <article class="community-card">
          <strong>Join discussions</strong>
          <p>Thousands of book clubs are chatting now. Jump in and talk about the plot twists.</p>
          <a class="goodreads-button" href="/pages/contact">Browse clubs</a>
        </article>
      </div>
    </section>

    <section id="quotes" class="section">
      <header>
        <h2 class="section-title">Quotes we&apos;re loving</h2>
        <p class="section-subtitle">Words that linger. Shareable lines from bestselling authors and timeless classics.</p>
      </header>
      <div class="quotes-grid">
        <article class="quote-card">
          <p>“A room without books is like a body without a soul.”</p>
          <span>— Marcus Tullius Cicero</span>
        </article>
        <article class="quote-card">
          <p>“We tell ourselves stories in order to live.”</p>
          <span>— Joan Didion</span>
        </article>
        <article class="quote-card">
          <p>“You can never get a cup of tea large enough or a book long enough to suit me.”</p>
          <span>— C.S. Lewis</span>
        </article>
        <article class="quote-card">
          <p>“Books are mirrors: you only see in them what you already have inside you.”</p>
          <span>— Carlos Ruiz Zafón</span>
        </article>
      </div>
    </section>

    <section class="section" id="community">
      <header>
        <h2 class="section-title">Join the PsychoReads newsletter</h2>
        <p class="section-subtitle">Weekly updates featuring trending reviews, new releases, and tailored recommendations.</p>
      </header>
      <div class="newsletter">
        <p>Stay on top of the literary world with curated highlights delivered to your inbox.</p>
        <form action="/contact" method="post">
          <input type="hidden" name="form_type" value="customer" />
          <input type="hidden" name="utf8" value="✓" />
          <input type="email" name="contact[email]" placeholder="Enter your email" aria-label="Email address">
          <button class="goodreads-button primary" type="submit">Subscribe</button>
        </form>
      </div>
    </section>
  </main>
</div>
